@page "/Amortizacion"

    <div class="container">
        <div class="card shadow-lg">
            <div class="card-header">
                <h3>Calculadora de Amortizaci√≥n</h3>
            </div>
            <div class=card-body>
                @*prestamoInicial:*@
                <div class="mb-3">
                    <label class="form-label" for="Fecha">Monto del prestamo:</label>
                        <input @bind="prestamoInicial" type="number" />
                </div>
                @*tasaInteresAnual*@
                <div class="mb-3">
                    <label class="form-label" for="tasaInteresAnual"> Tasa de interes:</label>
                        <input @bind="tasaInteresAnual" type="number" />
                </div>
                @*plazoMeses*@
                <div class="col-md-6">
                    <label class="form-label" for="plazoMeses">Plazo en meses :</label>
                        <input @bind="plazoMeses" type="number" />
                </div>
            </div>
            <div class="card-footer d-flex justify-content-center">
                <div class="btn-group">
                </div>
            </div>
        </div>
    </div>
        <div class="row">
            <button type="button" @onclick="CalcularAmortizacion" class="btn btn-primary input-group-text">
                <i class="oi oi-magnifying-glass " />
            </button>
        </div>
                @if (amortizacionCalculada)
                        {
                            <table class="table table-striped table-hover">
                                <thead>
                                    <tr>
                                        <th>Mes</th>
                                        <th>Saldo</th>
                                        <th>Pago Mensual</th>
                                        <th>Intereses</th>
                                        <th>Capital</th>
                                        <th></th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @foreach (var pago in tablaAmortizacion)
                                    {
                                        <tr>
                                            <td>@pago.Mes</td>
                                            <td>@pago.Saldo</td>
                                            <td>@pago.PagoMensual</td>
                                            <td>@pago.Intereses</td>
                                            <td>@pago.Capital</td>
                                        </tr>
                                    }

                                </tbody>

                            </table>
                        }
                    
                    <div class="card-footer">
                        <div class="form-row justify-content-sm-between" aria-orientation="vertical">
                            <div class="col-3">
                                <label for="CantidaRegistro" class="col-form-label"><strong>Filas</strong>&nbsp;</label>
                            </div>
                        </div>
                    </div>
                


@code {
    private double prestamoInicial;
    private double tasaInteresAnual;
    private int plazoMeses;
    private List<PagoAmortizacion> tablaAmortizacion;
    private bool amortizacionCalculada;

    private class PagoAmortizacion
    {
        public int Mes { get; set; }
        public double Saldo { get; set; }
        public double PagoMensual { get; set; }
        public double Intereses { get; set; }
        public decimal InteresFuncional { get; set; }   
        public double Capital { get; set; }
    }

    private void CalcularAmortizacion()
    {

        tablaAmortizacion = new List<PagoAmortizacion>();
        double saldo = prestamoInicial;
        double tasaInteresMensual = (tasaInteresAnual / 12) / 100;
        double pagoMensual = prestamoInicial * tasaInteresMensual / (1 - Math.Pow(1 + tasaInteresMensual, -plazoMeses));

        for (int mes = 1; mes <= plazoMeses; mes++)
        {
            double intereses = saldo * tasaInteresMensual;
            double capital = pagoMensual - intereses;
            saldo = capital;

            tablaAmortizacion.Add(new PagoAmortizacion
            {
                Mes = mes,
                Saldo = saldo,
                PagoMensual = pagoMensual,
                Intereses = intereses,
                Capital = capital
            });
        }

        amortizacionCalculada = true;
    }

}